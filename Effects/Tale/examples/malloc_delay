// Copyright (C) 2015 Theo Niessink
// License: GPL - http://www.gnu.org/licenses/gpl.html

desc:Delay
slider1:300<0,1000,1>Delay (ms)

import Tale/malloc.jsfx-inc

@slider

len = floor(srate * slider1 * 0.001);
len > 0 ? (
  buf = realloc(buf, len);
  idx %= len;
) : (
  buf = free(buf);
);

@sample

in = 0.5 * (spl0 + spl1);
buf ? buf[idx] = in + 0.5 * buf[idx];
idx = (idx + 1) % len;

out = buf ? 0.5 * buf[idx];
spl0 += out;
spl1 += out;
